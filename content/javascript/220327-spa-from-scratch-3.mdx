---
title: "Vanilla Javascriptë¡œ êµ¬í˜„í•˜ëŠ” SPA - ìƒíƒœ ê´€ë¦¬ ë„êµ¬"
date: "2022-03-27 17:05"
emoji: "ğŸ’€"
category: "javascript"
---
## ë¶ˆí¸í•¨ ê°ì§€í•˜ê¸°
í”„ë¡œì íŠ¸ì—ì„œ ëª¨ë‹¬ ì°½ì„ ì‚¬ìš©í•˜ê³  ì‹¶ì—ˆë‹¤. ëª¨ë‹¬ì€ í•˜ë‚˜ë¥¼ ë‘ê³  ë‚´ìš©ë¬¼ì„ ìƒíƒœì— ë”°ë¼ ë°”ê¿”ì£¼ëŠ” ê²ƒì´ ëª©í‘œë‹¤.

í˜„ì¬ ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```bash
App.js
â”œâ”€ Login.js
â””â”€ Main.js
    â”œâ”€ Modal.js
    â”œâ”€ Content.js
    â”‚   â””â”€ ...
    â””â”€ Sidebar.js
        â”œâ”€ Profile.js
        ...
```
ì—¬ê¸°ì„œ ë¶ˆí¸í•œ ì ì´ ë°œìƒí•œë‹¤. 

ëª¨ë‹¬ì˜ ìƒíƒœë³€í™”ëŠ” `Content.js`ë‚˜ `Sidebar.js`ì˜ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë³€ê²½ëœë‹¤.
ëª¨ë‹¬ì˜ ìƒíƒœë¥¼ ë³€í™”ì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” `Modal.js`ì˜ `setState` ë©”ì„œë“œë¥¼ ì € ë‘ ì»´í¬ë„ŒíŠ¸ì˜ ì•„ë˜ê¹Œì§€ ì „ë‹¬í•´ì•¼í•œë‹¤.
ì´ ìƒí™©ì€ ì •ë§ ê·€ì°®ë‹¤.

ì´ ë¬¸ì œëŠ” reactë‚˜ vueì—ì„œë„ ë˜‘ê°™ì´ ë°œìƒí•œë‹¤. 'Props drilling' ì´ìŠˆë¼ê³  í•œë‹¤.

Reactë‚˜ VueëŠ” ì´ ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í•´ê²°í• ê¹Œ? ë°”ë¡œ 'ìƒíƒœ ê´€ë¦¬ ì‹œìŠ¤í…œ'ì„ í†µí•´ì„œ í•´ê²°í•œë‹¤.
ì¤‘ì•™ ì§‘ì¤‘ì‹ ì €ì¥ì†Œë¥¼ ë‘ ìœ¼ë¡œì¨ ì–´ë–¤ ì»´í¬ë„ŒíŠ¸ë˜ íŠ¹ì • ìƒíƒœì— ë°”ë¡œ ì ‘ê·¼ì´ ê°€ëŠ¥í•´ì§„ë‹¤.
ReactëŠ” Redux, VueëŠ” Vuexë¥¼ ëŒ€í‘œì ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.

## êµ¬í˜„
> ìƒíƒœ ê´€ë¦¬ ë„êµ¬ì˜ êµ¬í˜„ì„ ìœ„í•´ì„œëŠ” '[ì˜µì €ë²„ íŒ¨í„´](https://woong-jae.com/javascript/220322-observer-pattern)'ì— ëŒ€í•œ ì´í•´ê°€ ì„ í–‰ë˜ì–´ì•¼ í•œë‹¤.

ëŒ€ë¶€ë¶„ì˜ êµ¬í˜„ì„ [ì´ í¬ìŠ¤íŠ¸](https://junilhwang.github.io/TIL/Javascript/Design/Vanilla-JS-Store/)ì—ì„œ ì°¸ê³ í–ˆë‹¤. ì •ë§ ê°ì‚¬í•©ë‹ˆë‹¤!

### Vuex?
ì°¸ê³ í•œ êµ¬í˜„ì€ vuexë¥¼ ëª¨ë°©í•œ í˜•ì‹ì´ë‹¤.

Vuexì— ëŒ€í•´ ê°„ë‹¨íˆë§Œ ì•Œì•„ë³´ì.

<img src="https://vuex.vuejs.org/vuex.png" width="500px"/>

`state`ë¥¼ ì˜¤ì§ `mutations`ë¡œë§Œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. `actions`ëŠ” ë°±ì•¤ë“œ apië¥¼ ê°€ì ¸ì˜¨ ë’¤ `mutations`ë¥¼ ì´ìš©í•  ë•Œ ì‚¬ìš©í•œë‹¤.
ë‚˜ëŠ” ì¼ë‹¨ `state`ì™€ `mutations`ë§Œ êµ¬í˜„í•´ë³´ê³ ì í–ˆë‹¤.

Vuexì˜ ê°€ì¥ ê°„ë‹¨í•œ ì‚¬ìš© ì˜ˆì‹œë¥¼ ì‚´í´ë³´ì.

```js
import { createStore } from 'vuex'

const store = createStore({
  state: {
    count: 0
  },
  mutations: {
    increment (state) {
      state.count++
    }
  }
});

store.commit('increment');

console.log(store.state.count);
// -> 1
```

`createStore`ë¥¼ í†µí•´ `state`ì™€ `mutations`ë¥¼ ì •ì˜í•´ì£¼ê³ , `commit`ì„ í†µí•´ `mutations`ì— ì„ ì–¸ëœ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.

`createStore`ì™€ ë¹„ìŠ·í•˜ê²Œ `Store.js` í´ë˜ìŠ¤ë¥¼ êµ¬ì„±í•´ë³´ì.

`state`ë¥¼ `observable`ë¡œ ë§Œë“¤ì–´ì£¼ê³ , ì˜¤ì§ `commit`ë§Œìœ¼ë¡œ `state`ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼í•œë‹¤.

```js
import { observable } from "./observer.js";

export default class Store {
    #state;
    #mutations;
    state = {};
    constructor({ state, mutations }) {
        this.#state = observable(state);
        this.#mutations = mutations;

        Object.keys(state).forEach(key => {
            Object.defineProperty(
              this.state,
              key,
              { get: () => this.#state[key] },
            );
        });
    }
    commit(action, payload) {
        this.#mutations[action](this.#state, payload);
    }
}
```
`state`ë¥¼ private í”„ë¡œí¼í‹°ë¡œ ì €ì¥í•´ ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ì—†ê²Œ í–ˆë‹¤. 
í•˜ì§€ë§Œ ìƒíƒœ ê°’ì„ ì½ì„ ìˆ˜ëŠ” ìˆê²Œ í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ê° í”„ë¡œí¼í‹°ë§ˆë‹¤ getterë¥¼ ë‹¬ì•„ì¤˜ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ í–ˆë‹¤.
`set` ë©”ì„œë“œë¥¼ ì •ì˜í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ìƒíƒœë¥¼ ì§ì ‘ì ìœ¼ë¡œ í• ë‹¹í•  ìˆ˜ ì—†ë‹¤.

`commit`ì„ í˜¸ì¶œí•˜ë©´ `action`ì— ë§ëŠ” `mutations`ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ ìƒíƒœë¥¼ ë³€ê²½í•˜ê²Œ ëœë‹¤.

ì´ì œ `state`ë¥¼ observableë¡œ ë§Œë“¤ì–´ ì¤¬ìœ¼ë‹ˆ, `state`ê°€ ë³€ê²½ëì„ ë•Œ ë‹¤ì‹œ ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ ë  ìˆ˜ ìˆê²Œ observeì— ë“±ë¡í•´ì£¼ë©´ ëœë‹¤.

```js
import { observe } from "./observer.js";

export default class Component {
    constructor(target, props) {
        this.target = target;
        this.props = props;
        this.state = {};
        this.setup();
        // ì»´í¬ë„ŒíŠ¸ì—ì„œ ìŠ¤í† ì–´ì˜ ìƒíƒœë¥¼ observeí•´ renderì™€ mountedë¥¼ ìˆ˜í–‰í•œë‹¤.
        observe(() => {
            this.render();
            this.mounted();
        });
    }
    template() { return ``; }
    setup() {};
    render() { this.target.innerHTML = this.template(); }
    mounted() {}
    updated() {}
    setState(newState) {
        this.state = { ...this.state, ...newState };
        this.render();
        this.updated();
    }
};
```

## í”„ë¡œì íŠ¸ì— ì ìš©
í”„ë¡œì íŠ¸ì— ì ìš©ëœ ëª¨ìŠµì€ ì•„ë˜ì™€ ê°™ë‹¤.

```bash
.
â”œâ”€ index.html
â””â”€ src
    â”œâ”€ index.js
    â”œâ”€ store.js
    â”œâ”€ App.js
    â”œâ”€ components
    â”‚   â””â”€ ... 
    â””â”€ core
        â”œâ”€ Component.js
        â”œâ”€ Store.js
        â”œâ”€ observer.js
        â””â”€ Router.js
```

- observer.js

```js
let requestingObserver = null;

export const observe = (notify) => {
  requestingObserver = notify;
  notify();
  requestingObserver = null;
};

export const observable = (object) => {
  const observersPerProps = new Map();
  return new Proxy(object, {
    get(target, prop) {
      if (!observersPerProps.has(prop)) observersPerProps.set(prop, new Set());
      if (requestingObserver) observersPerProps.get(prop).add(requestingObserver);
      return target[prop];
    },
    set(target, prop, val) {
      if (target[prop] === val) return true;
      if (JSON.stringify(target[prop]) === JSON.stringify(val)) return true;
      target[prop] = val;
      observersPerProps.get(prop).forEach((notify) => notify());
      return true;
    }
  });
};
```

- store.js

```js
import Store from "./core/Store.js";

export const store = new Store({
    state: {
        modal: null,
    },
    mutations: {
        CHANGE_MODAL(state, payload) {
            state.modal = payload;
        },
        CLOSE_MODAL(state) {
            state.modal = null;
        },
    }
});
```

- Modal.js
```js
import Component from "../core/Component.js";

import { store } from "../store.js";

export default class Modal extends Component {
    template() {
        return `
        <div class="modal">...</div>
        <style>
        .modal {
            position: absolute;
            display: ${store.state.modal ? "block" : "none"};
            justify-content: center;
            align-items: center;
            left: 0;
            top: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
        }
        </style>
        `;
    }
}
```

ì´ë ‡ê²Œ ì›í•˜ë˜ ëŒ€ë¡œ ëª¨ë‹¬ ì°½ êµ¬í˜„ì„ í•  ìˆ˜ ìˆì—ˆë‹¤.

<br/>

ì°¸ì¡°:  
<https://junilhwang.github.io/TIL/Javascript/Design/Vanilla-JS-Store/#_5-flux-pattern>  
<https://peter-cho.gitbook.io/book/5/5_2>  
<https://vuex.vuejs.org/>