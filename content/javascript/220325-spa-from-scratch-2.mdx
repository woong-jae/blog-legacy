---
title: "Vanilla Javascriptë¡œ êµ¬í˜„í•˜ëŠ” SPA - ë¼ìš°íŒ…"
date: "2022-03-25 23:37"
emoji: "ğŸ’€"
category: "javascript"
---

## SPA Router

Single-Page Application(SPA)ëŠ” ê¸°ì¡´ ë©€í‹° í˜ì´ì§€ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ê³¼ ë‹¤ë¥´ê²Œ ê²½ë¡œê°€ ë³€ê²½ë˜ë„ ìƒˆë¡œ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹  URL ê²½ë¡œì— ë”°ë¼ ì˜¬ë°”ë¥¸ ì½˜í…ì¸ ë¥¼ ê·¸ë•Œ ê·¸ë•Œ ê·¸ë ¤ì¤€ë‹¤.

ì´ ì¼ì„ 'Router'ê°€ í•´ì¤€ë‹¤.

ëª¨ë“  routerëŠ” ìµœì†Œ 2ê°œì˜ í•µì‹¬ ê¸°ëŠ¥ì„ ì œê³µí•´ì•¼í•œë‹¤.

1. ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ëª¨ë“  ê²½ë¡œë¥¼ ì €ì¥í•œ ë ˆì§€ìŠ¤íŠ¸ë¦¬(registry)
2. URLì˜ ë³€ê²½ì„ ê°ì§€í•´ ì ì ˆí•œ í™”ë©´ì„ ë³´ì—¬ì¤Œ

URL ë³€ê²½ì„ ê°ì§€í•˜ëŠ” ë°©ë²•ì€ ë‘ ê°€ì§€ê°€ ìˆë‹¤. Fragment identifierë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ê³¼ History APIë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ë‹¤.

Fragment identifierëŠ” í˜„ì¬ ì›¹ í˜ì´ì§€ì˜ íŠ¹ì • ë¶€ë¶„ì„ ì‹ë³„í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `www.domain.org/foo.html#bar`ì—ì„œ `#bar`ì´ fragment identifierë‹¤. `foo.html`ì—ì„œ `id="bar"`ì¸ ìš”ì†Œë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. Fragmentê°€ ë³€ê²½ë˜ë©´ `hashchange`ê°€ ë°œìƒí•˜ëŠ”ë°, ì´ ì´ë²¤íŠ¸ì— ëŒ€í•´ ë¦¬ìŠ¤ë„ˆë¥¼ ë¶™ì—¬ì„œ routerë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ, ëª»ìƒê²¼ë‹¤ê³  ìƒê°í•´ì„œ History APIë¥¼ ì‚¬ìš©í•˜ê² ë‹¤.

### êµ¬í˜„í•˜ê¸°

ë¼ìš°í„°ëŠ” ìƒˆë¡œìš´ ê²½ë¡œ ì¶”ê°€, ê²½ë¡œì— ë§ëŠ” ì»´í¬ë„ŒíŠ¸ í˜¸ì¶œ, URL ë³€ê²½ì„ ê°ì§€í•´ì•¼ í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

- `addRoute`: ìƒˆë¡œìš´ ê²½ë¡œì™€ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ê°€í•œë‹¤.
- `start`: URL ë³€ê²½ ê°ì§€ë¥¼ ì‹œì‘í•œë‹¤.
- `checkRoutes`: í˜„ì¬ ê²½ë¡œì— ë§ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ í˜¸ì¶œí•œë‹¤. í˜„ì¬ëŠ” ê°„ë‹¨í•˜ê²Œ `Map`ì„ ì‚¬ìš©í•´ ì¼ì¹˜í•˜ëŠ” ê²ƒì„ ì°¾ë„ë¡ í–ˆë‹¤.

```js
const createRouter = () => {
  const routeToView = new Map();
  let notFound = () => {};

  function addRoute(route, view) {
    routeToView.set(route, view);
    return this;
  }

  function setNotFound(cb) {
    notFound = cb;
    return this;
  }

  function start() {
    window.addEventListener("click", (event) => {
      const { target } = event;
      if (target.matches("button[data-navigate]")) {
        const { navigate } = target.dataset;
        history.pushState({}, "", navigate);
        checkRoutes();
      }
    });

    window.addEventListener("popstate", () => {
      checkRoutes();
    });

    checkRoutes();
    return this;
  }

  function checkRoutes() {
    const currentRoute = routeToView.get(window.location.pathname);
    if (!currentRoute) {
      notFound();
      return;
    }
    currentRoute();
  }

  return {
    addRoute,
    setNotFound,
    start,
    checkRoutes,
  };
};
```

`setNotFound`ëŠ” ë§ëŠ” ê²½ë¡œê°€ í•˜ë‚˜ë„ ì—†ì„ ë•Œ ë³´ì—¬ì¤„ í™”ë©´ì´ë‚˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜ë‹¤.

ê°€ì¥ ì¤‘ìš”í•œ `start` í•¨ìˆ˜ë¥¼ ì‚´í´ë³´ì.

```js
function start() {
  window.addEventListener("click", (event) => {
    const { target } = event;
    if (target.matches("button[data-navigate]")) {
      const { navigate } = target.dataset;
      history.pushState({}, "", navigate);
      checkRoutes();
    }
  });

  window.addEventListener("popstate", () => {
    checkRoutes();
  });

  checkRoutes();
  return this;
}
```

ì²« ë²ˆì§¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” í™”ë©´ ì „í™˜ì„ ë‹´ë‹¹í•œë‹¤.
í´ë¦­í•œ ë²„íŠ¼ ìš”ì†Œì— `data-navigate` ì†ì„±ì´ ìˆë‹¤ë©´ í™”ë©´ ì „í™˜ ì´ë²¤íŠ¸ê°€ ë°œìƒí–ˆë‹¤ê³  ê°„ì£¼í•œë‹¤. History APIì˜ `pushstate`Â ë©”ì„œë“œë¥¼ ì´ìš©í•˜ë©´ ë¸Œë¼ìš°ì €ì˜ ì„¸ì…˜ ê¸°ë¡ ìŠ¤íƒì— ìƒíƒœë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œ ê°±ì‹ í•˜ì§€ ì•Šê³  ì£¼ì†Œë§Œ ìƒˆë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤. ì£¼ì†Œë¥¼ ìƒˆë¡œ ë°”ê¾¼ í›„ì— `checkRoutes`ë¥¼ í†µí•´ ì ì ˆí•œ í™”ë©´ì„ ë³´ì—¬ì¤€ë‹¤.

`data-` ì†ì„±ì„ ì‚¬ìš©í•œ í™”ë©´ ì „í™˜ì´ ì‹«ë‹¤ë©´, routerì— `navigate` ê°™ì€ ê²½ë¡œ ë³€ê²½ìš© í•¨ìˆ˜ë¥¼ ì„ ì–¸í•´ ì‚¬ìš©í•´ë„ ê´œì°®ì„ ê²ƒ ê°™ë‹¤.

ë‘ ë²ˆì§¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ì•ìœ¼ë¡œ ê°€ê¸°ì™€ ë’¤ë¡œê°€ê¸°ë¥¼ ë‹´ë‹¹í•œë‹¤. `popstate` ì´ë²¤íŠ¸ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì•ìœ¼ë¡œ ê°€ê¸°, ë’¤ë¡œê°€ê¸°ë¥¼ í–ˆì„ ë•Œ ë°œìƒí•œë‹¤. ì´ë•ŒëŠ” ê²½ë¡œì— ë§ëŠ” ì ì ˆí•œ í™”ë©´ì„ ë³´ì—¬ì£¼ë©´ ëœë‹¤.

### ì‚¬ìš©í•˜ê¸°

êµ¬í˜„í•œ routerë¥¼ ì‹œí—˜í•´ë³´ê¸° ìœ„í•´ ê°„ë‹¨í•œ htmlì„ ì¤€ë¹„í–ˆë‹¤. ê²½ë¡œì— ì ì ˆí•œ í™”ë©´ì„ `main` ìš”ì†Œ ì•ˆì— ë³´ì—¬ì¤„ ê²ƒì´ë‹¤.

```html
<body>
  <ul>
    <li>
      <button data-navigate="/">main</button>
    </li>
    <li>
      <button data-navigate="/list">list</button>
    </li>
  </ul>
  <main></main>
</body>
```

Routerë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

```js
const createPages = (container) => {
  const home = () => {
    container.innerHTML = "home page";
  };
  const list = () => {
    container.innerHTML = "list page";
  };
  const notFound = () => {
    container.innerHTML = "not found";
  };

  return {
    home,
    list,
    notFound,
  };
};

const pages = createPages(document.querySelector("main"));
const router = createRouter();

router.addRoute("/", pages.home).addRoute("/list", pages.list).setNotFound(pages.notFound).start();
```

ì‹¤ì œ ì‚¬ìš©í•´ë³´ë©´ ì›í•˜ëŠ” ëŒ€ë¡œ ì˜ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### ê²½ë¡œ íŒŒë¼ë¯¸í„°

ì–´ë–¤ í˜ì´ì§€ë“¤ì€ ê²½ë¡œ ì •ë³´ë¡œ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ” ê¸°ëŠ¥ì´ í•„ìš”í•˜ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `https://woong-jae.com/javascript/220325-spa-from-scratch-2`ëŠ” ì´ ë¸”ë¡œê·¸ì˜ `javascript` ì¹´í…Œê³ ë¦¬ì˜ `220325-spa-from-scratch-2` ê¸€ì„ í™”ë©´ì— ë³´ì—¬ì¤€ë‹¤. ì´ ì •ë³´ë¥¼ URLìœ¼ë¡œ í‘œí˜„í•˜ë©´ `/:category/:post`ê°€ ë  ê²ƒì´ë‹¤. ì´ì²˜ëŸ¼ íŒŒë¼ë¯¸í„°ë¥¼ ê°€ì§„ ê²½ë¡œë¥¼ êµ¬í˜„í•´ë³´ì.

ìš°ì„  `addRoute`ì—ì„œ ê²½ë¡œë¥¼ ë“±ë¡í•˜ëŠ” ë°©ì‹ì„ ë³€ê²½í•´ì•¼ í•œë‹¤. ê²½ë¡œë¥¼ ë§¤ì¹­í•  ìˆ˜ ìˆê²Œ ë°›ì€ ê²½ë¡œë¥¼ ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ ë°”ê¿”ì£¼ëŠ” ì‘ì—…ì„ í•  ê²ƒì´ë‹¤.

ê²½ë¡œì—ì„œ íŒŒë¼ë¯¸í„°ì— í•´ë‹¹í•˜ëŠ” ì •ê·œ í‘œí˜„ì‹ì€ `/:(\w)+`ë¡œ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆë‹¤. `String.prototype.replace` ë©”ì„œë“œë¥¼ í†µí•´ ë°›ì€ ê²½ë¡œì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì „ë¶€ `([^\\/]+)`ë¡œ ì¹˜í™˜í•´ì¤€ë‹¤. `([^\\/]+)`ëŠ” / ë‚˜ \\ ë¥¼ í¬í•¨í•˜ì§€ ì•ŠëŠ” ë¬¸ìì—´ì„ ì˜ë¯¸í•œë‹¤.

```js
const ROUTE_PARAMETER_REGEX = /:(\w+)/g;
const URL_FRAGMENT_REGEX = "([^\\/]+)";

const createRouter = () => {
  // const routeToView = new Map();
  const routes = [];
  // ...
  function addRoute(route, view) {
    const params = [];

    const parsedRoute = route
      .replace(ROUTE_PARAMETER_REGEX, (match, paramName) => {
        params.push(paramName);
        return URL_FRAGMENT_REGEX;
      })
      .replace(/\//g, "\\/");

    routes.push({
      testRegExp: new RegExp(`^${parsedRoute}$`),
      view,
      params,
    });

    return this;
  }
};
```

ì´ì œ ê²½ë¡œì—ì„œ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤. ê²½ë¡œì— ëŒ€í•´ `String.prototype.match`ì™€ ë°©ê¸ˆ êµ¬í•œ `testRegExp`ë¥¼ ì‚¬ìš©í•˜ë©´ ì‰½ê²Œ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤.

```js
const createRouter = () => {
  // const routeToView = new Map();
  const routes = [];
  // ...
  const extractURLParams = (route, pathName) => {
    if (route.params.length === 0) return {};

    const matches = pathName.match(route.testRegExp);

    matches.shift();

    const params = {};
    matches.forEach((paramValue, index) => {
      const paramName = route.params[index];
      params[paramName] = paramValue;
    });

    return params;
  };
};
```

`checkRoutes`ì—ì„œëŠ” `testRegExp`ë¥¼ ì‚¬ìš©í•´ ì¼ì¹˜í•˜ëŠ” ê²½ë¡œë¥¼ ì°¾ê³ , íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ì¶œí•´ `view`ì— ì „ë‹¬í•´ì£¼ë©´ ëœë‹¤.

```js
function checkRoutes() {
  const path = window.location.pathname;
  const currentRoute = routes.find(({ testRegExp }) => testRegExp.test(path));
  if (!currentRoute) {
    notFound();
    return;
  }

  const urlParams = extractURLParams(currentRoute, path);

  currentRoute.view(urlParams);
}
```

ì•„ê¹Œ ì‚¬ìš©í•˜ê¸°ì— ê²½ë¡œë¥¼ ì¶”ê°€í•´ì„œ ì‚¬ìš©í•´ë³´ë©´ ì›í•˜ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ í™”ë©´ì— ì œëŒ€ë¡œ ë³´ì—¬ì£¼ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```js
const createPages = (container) => {
  const home = () => {
    container.innerHTML = "home page";
  };
  const list = () => {
    container.innerHTML = "list page";
  };
  const blog = ({ category, post }) => {
    contaner.innerHTML = `category: ${category}, post: ${post}`;
  };
  const notFound = () => {
    container.innerHTML = "not found";
  };

  return {
    home,
    list,
    blog,
    notFound,
  };
};

const pages = createPages(document.querySelector("main"));
const router = createRouter();

router
  .addRoute("/", pages.home)
  .addRoute("/list", pages.list)
  .addRoute("/blog/:category/:post", pages.blog)
  .setNotFound(pages.notFound)
  .start();
```

## ì°¸ì¡°

- Frameworkless Frontend Development
- <https://developer.mozilla.org/ko/docs/Web/API/History/pushState>
