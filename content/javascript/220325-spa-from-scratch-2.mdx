---
title: "Vanilla Javascriptë¡œ êµ¬í˜„í•˜ëŠ” SPA - ë¼ìš°íŒ…"
date: "2022-03-25 10:27"
emoji: "ğŸ’€"
category: "javascript"
---
## í•„ìš”ì„±
ì§€ê¸ˆ ì§„í–‰ì¤‘ì¸ í”„ë¡œì íŠ¸ëŠ” Github OAuthë¥¼ ì‚¬ìš©í•´ ìœ ì €ë¥¼ ì¸ì¦í•œë‹¤.

ë©”ì¸ í™”ë©´ì€ ë¡œê·¸ì¸ í™”ë©´ì´ë‹¤.
ì—¬ê¸°ì„œ ë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìœ ì €ëŠ” ì¸ì¦ì„ ìœ„í•´ ê¹ƒí—ˆë¸Œë¡œ ë³´ë‚´ì ¸ ë¡œê·¸ì¸ì„ í•œ í›„ ëª…ì‹œí•œ 'ì½œë°± url'ì„ í†µí•´ ë‹¤ì‹œ ëŒì•„ì˜¤ê²Œ ëœë‹¤.
ë‹¤ì‹œ ëŒì•„ì™”ì„ ë•ŒëŠ” urlì— `code`ë€ ê²ƒì´ ë”¸ë ¤ì˜¤ëŠ”ë°, ì´ê²ƒì„ ì„œë²„ì— ë³´ë‚´ë©´ ì„œë²„ì—ì„œ ì—¬ëŸ¬ ì‘ì—…ì„ í•œ í›„ jwt í† í°ì„ ë°œê¸‰í•´ì¤€ë‹¤.

ì—¬ê¸°ì„œ ì½œë°± urlì„ ë©”ì¸ í™”ë©´ìœ¼ë¡œ í•˜ë©´ **ìœ ì €ëŠ” ë¡œê·¸ì¸ í™”ë©´ì„ ë‹¤ì‹œ ë³¸ í›„ì— ë¡œê·¸ì¸ë¼ì„œ ë‹¤ë¥¸ í™”ë©´ì„ ë³´ê²Œ ëœë‹¤**.
ê·¸ë ‡ë‹¤ë©´ ë¡œê·¸ì¸ í™”ë©´ì„ ì•ˆë³´ê²Œ í• ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?

ì •ë‹µì€ ê°„ë‹¨í–ˆë‹¤. ë‹¤ë¥¸ urlë¡œ ë³´ë‚´ì„œ ì²˜ë¦¬í•˜ë©´ ëœë‹¤. ë¬¸ì œëŠ” "ì´ê²ƒì„ ì–´ë–»ê²Œ SPAì—ì„œ êµ¬í˜„í•˜ëŠëƒ"ì˜€ë‹¤.

## êµ¬í˜„
SPAì—ì„œëŠ” ì „í†µì ì¸ ë§í¬ ë°©ì‹ê³¼ ë‹¤ë¥´ê²Œ ê²½ë¡œê°€ ë³€ê²½ë˜ë„ ìƒˆë¡œ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ì•ŠëŠ”ë‹¤. 
ëŒ€ì‹  ì´ˆê¸° ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë¡œë“œí•  ë•Œ ëª¨ë“  ì›¹ì‚¬ì´íŠ¸ ì½˜í…ì¸ ë¥¼ ë¡œë“œí•˜ê³ , URL ê²½ë¡œì— ë”°ë¼ ì˜¬ë°”ë¥¸ ì½˜í…ì¸ ë¥¼ ë³´ì—¬ì¤€ë‹¤.

SPA ë¼ìš°íŒ…ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” ì•ìœ¼ë¡œ ê°€ê¸°, ë’¤ë¡œ ê°€ê¸°, ë§í¬ë¥¼ í†µí•œ ê²½ë¡œ ì´ë™ì„ ë‚´ê°€ ì§ì ‘ ì²˜ë¦¬í•´ì¤˜ì•¼ í•œë‹¤.

ì´ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì´ 'History API'ë‹¤.

### History API
History API ì˜ `pushstate` ë©”ì„œë“œë¥¼ ì´ìš©í•˜ë©´ ë¸Œë¼ìš°ì €ì˜ ì„¸ì…˜ ê¸°ë¡ ìŠ¤íƒì— ìƒíƒœë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.
ì‰½ê²Œ ë§í•˜ë©´ í˜ì´ì§€ëŠ” ìƒˆë¡œ ê°±ì‹ í•˜ì§€ ì•ŠëŠ”ë° ì£¼ì†Œë§Œ ìƒˆë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.

ì´ê²ƒì„ ì‚¬ìš©í•´ì„œ í˜ì´ì§€ ë‚´ì—ì„œ ê²½ë¡œ ì´ë™ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

ë³´í†µì€ ê²½ë¡œë§ˆë‹¤ ë Œë”í•´ì¤„ ì»´í¬ë„ŒíŠ¸ë¥¼ ì§ì§€ì–´ ë†“ì§€ë§Œ, ë‚˜ëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ë‹¬ì•„ì¤¬ë‹¤.
íŠ¹ì • ê²½ë¡œì— ëŒ€í•´ ì½œë°±ì„ ë°›ë„ë¡ í•œ ì´ìœ ëŠ”, ê¹ƒí—ˆë¸Œ OAuth ë•Œë¬¸ì´ë‹¤. 
ê¹ƒí—ˆë¸Œì—ì„œ ì¸ì¦ í›„ Redirect URLë¡œ ë„˜ì–´ì™”ì„ ë•Œ, ì„œë²„ì™€ í†µì‹ ë§Œ í•˜ê³  ì»´í¬ë„ŒíŠ¸ëŠ” ë Œë”í•˜ì§€ ì•Šê²Œ í•˜ê³  ì‹¶ì—ˆê¸° ë•Œë¬¸ì´ë‹¤.

```js
/** 
 * @param path {Map}
 */
function render(path) {
    // ê²½ë¡œ ì •ë³´ê°€ ì¡´ì¬í•˜ë©´ ì½œë°± í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì¤€ë‹¤.
    if(this.routes.has(path)) this.routes.get(path)();
    // ê²½ë¡œ ì •ë³´ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° ë©”ì¸ í™”ë©´ì„ ë„ì–´ì¤€ë‹¤.
    else {
        history.pushState({}, "", "/");
        this.routes.get("/")();
    };
}
```

ì•ìœ¼ë¡œ ê°€ê¸°ì™€ ë’¤ë¡œê°€ê¸°ëŠ” ì–´ë–»ê²Œ ì²˜ë¦¬í• ê¹Œ? ì´ë•ŒëŠ” `window.onpopstate` ì´ë²¤íŠ¸ë¥¼ í™œìš©í•˜ë©´ ëœë‹¤.
ì´ ì´ë²¤íŠ¸ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì•ìœ¼ë¡œ ê°€ê¸°, ë’¤ë¡œê°€ê¸°ë¥¼ í–ˆì„ ë•Œ ë°œìƒí•œë‹¤.

ì—¬ê¸°ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë‹¬ì•„ `render()`ë¥¼ í˜¸ì¶œí•´ì£¼ë©´ ì ì ˆí•˜ê²Œ í™”ë©´ì„ ë°”ê¿€ ìˆ˜ ìˆë‹¤.

```js
window.addEventListener("popstate", () => {
    render(location.pathname);
});
```

### Router í´ë˜ìŠ¤ ì •ì˜í•˜ê¸°
ìœ„ì—ì„œ ì‚¬ìš©í•œ ì½”ë“œë“¤ì„ `Router` í´ë˜ìŠ¤ì— ëª¨ì•˜ë‹¤.

`Router`ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ë•ŒëŠ” `[ê²½ë¡œ, ì½œë°±]` ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ë°°ì—´ì„ ë„˜ê²¨ì¤˜ ì‚¬ìš©í•˜ê²Œ í–ˆë‹¤. 
ì´ ë°°ì—´ì€ ì¸ìŠ¤í„´ìŠ¤ ë‚´ë¶€ì— `Map`ìœ¼ë¡œ ë³´ê´€í•˜ë„ë¡ í•´ì„œ íŠ¹ì • ê²½ë¡œì˜ ê²€ìƒ‰ì„ ë” íš¨ìœ¨ì ìœ¼ë¡œ í•  ìˆ˜ ìˆë„ë¡ í–ˆë‹¤.

`Router` ì¸ìŠ¤í„´ìŠ¤ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ ìµœìƒë‹¨ì— í•˜ë‚˜ë§Œ í•„ìš”í•˜ê³  ì¶”ê°€ì ì¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ë©´ ì•ˆëœë‹¤.
**ë”°ë¼ì„œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ë§Œ ë‘ê³  ì´ ì¸ìŠ¤í„´ìŠ¤ ë§Œìœ¼ë¡œ ëª¨ë“  ê²ƒì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ [ì‹±ê¸€í†¤ íŒ¨í„´](https://woong-jae.com/javascript/220319-singleton-pattern)ìœ¼ë¡œ êµ¬í˜„í–ˆë‹¤.**

ì™„ì„±ëœ ë¼ìš°í„°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
```js
export default class Router {
    static #instance;
    constructor(routes) {
        if(Router.#instance) return Router.#instance;

        this.routes = new Map(routes);

        window.addEventListener("popstate", () => {
            this.render(location.pathname);
        });

        this.render(location.pathname);
        Router.#instance = this;
    }
    render(path) {
        if(this.routes.has(path)) this.routes.get(path)();
        else {
            history.pushState({}, "", "/");
            this.routes.get("/")();
        };
    }
}
```

ì¡°ê¸ˆ ì—‰ì„±í•˜ì§€ë§Œ í”„ë¡œì íŠ¸ì— ì‚¬ìš©í•˜ê¸°ì—ëŠ” ë¬´ë¦¬ ì—†ì–´ ë³´ì¸ë‹¤.

## í”„ë¡œì íŠ¸ì— ì ìš©
í”„ë¡œì íŠ¸ì— ì ìš©ëœ ëª¨ìŠµì€ ì•„ë˜ì™€ ê°™ë‹¤.
```bash
.
â”œâ”€ index.html
â””â”€ src
    â”œâ”€ index.js
    â”œâ”€ App.js
    â”œâ”€ components
    â”‚   â”œâ”€ Login.js
    â”‚   â””â”€ Main.js
    â””â”€ core
        â”œâ”€ Component.js
        â””â”€ Router.js
```

- App.js
```js
import Component from "./core/Component.js";
import Router from "./core/Router.js";

import Login from "./components/Login.js";
import Main from "./components/Main.js";
import Loading from "./components/common/Loading.js";

export default class App extends Component {
    template() {
        return `
        <div id="app"></div>
        <style>
        #app {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #35393F;
        }
        </style>
        `
    }
    mounted() {
        const app = document.getElementById("app");
        new Router([
            [
                "/",
                () => { new Login(app); }
            ],
            [
                "/login",
                async () => {
                    new Loading(app);
                    // ë¡œê·¸ì¸ ì²˜ë¦¬ ë¡œì§
                    // ë’¤ë¡œ ëŒì•„ê°€ê¸°ë¥¼ í•´ë„ '/login'ìœ¼ë¡œ ë‹¤ì‹œ ëŒì•„ê°€ì§€ ì•Šê²Œí•˜ê¸° ìœ„í•´ location.replace ì‚¬ìš©
                    location.replace("/main");
                }
            ],
            [
                "/main",
                () => { new Main(app); }
            ]
        ]);
    }
};
```

<br/>

ì°¸ì¡°:  
<https://velog.io/@seeh_h/VanilaJS%EB%A1%9C-SPA-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0>  
<https://kdydesign.github.io/2020/10/06/spa-route-tutorial/>  
<https://www.zerocho.com/category/HTML&DOM/post/599d2fb635814200189fe1a7>  
<https://developer.mozilla.org/ko/docs/Web/API/History/pushState>
