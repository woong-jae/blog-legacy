---
title: "Web Worker"
date: "2022-10-25 21:57"
emoji: "ğŸ‘¨â€ğŸ­"
category: "javascript"
---

"ì–´ë–¤ ê¸°ëŠ¥ì´ ë¬´ì¡°ê±´ 2ì´ˆ ë’¤ì— ì‹¤í–‰ë˜ê²Œ ë³´ì¥í•´ì£¼ì„¸ìš”!"ë¼ëŠ” ìš”êµ¬ì‚¬í•­ì„ ë°›ì•˜ë‹¤ê³  í•´ë³´ì. `setTimeout`ìœ¼ë¡œ 2ì´ˆ ë’¤ì— ê·¸ ê¸°ëŠ¥ì„ ì‹¤í–‰í•˜ë„ë¡ í•˜ë©´ ë ê¹Œ? ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì—, call stackì—ì„œ 3ì´ˆ ì´ìƒ ê±¸ë¦¬ëŠ” ì‘ì—…ì´ ìˆëŠ” ê²½ìš° ê·¸ ê¸°ëŠ¥ì€ 3ì´ˆë¥¼ ë„˜ê²¨ ë™ì‘í•˜ê²Œ ë  ê²ƒì´ë‹¤.

```js
const start = new Date();
const timeout = 2000;
setTimeout(() => {
  console.log(`from timeout ${new Date() - start}`);
}, timeout);

while (new Date() - start < 3000);
```

ì´ë•Œ ì›¹ ì›Œì»¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì›¹ ì›Œì»¤ë¡œ ìƒˆë¡œìš´ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•´ì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. WorkerëŠ” ë©”ì¸ ìŠ¤ë ˆë“œì˜Â [`window`](https://developer.mozilla.org/ko/docs/Web/API/Window)ì™€ëŠ” ë‹¤ë¥¸ ê¸€ë¡œë²Œ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— DOM ì¡°ì‘ì´ë‚˜, console ê°ì²´ì˜ ì‚¬ìš© ë“±ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤. ê° workerëŠ” ë³„ë„ì˜ í™, ìŠ¤íƒ, í, ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ í• ë‹¹ë°›ëŠ”ë‹¤.

ë©”ì¸ ìŠ¤ë ˆë“œì™€ web workerëŠ” ë©”ì‹œì§€ ë°©ì‹ìœ¼ë¡œ ì„œë¡œ í†µì‹ í•  ìˆ˜ ìˆë‹¤. ì–‘ìª½ ëª¨ë‘ `postMessage` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ê³ , `onmessage` ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¡œ ë©”ì‹œì§€ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤. ì „ì†¡ë˜ëŠ” ë°ì´í„°ëŠ” ë³µì‚¬ë¼ ì „ë‹¬ëœë‹¤. ë•Œë¬¸ì— ê°™ì€ ë°ì´í„°ì— ëŒ€í•œ ê²½í•© ì¡°ê±´ì´ ì—†ì–´ ë™ê¸°í™” ë¬¸ì œëŠ” ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ, í° ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ëŠ”ë‹¤ë©´ ë³µì‚¬ë³¸ì„ ìƒì„±í•˜ëŠ”ë° ë¹„ìš©ì´ ë§ì´ ë“ ë‹¤.

## ì¢…ë¥˜

Web workerëŠ” ë‘ ê°€ì§€ íƒ€ì…ì´ ìˆë‹¤.

- Dedicated worker(ì „ìš© ì›Œì»¤): ìƒì„±í•œ ì›Œì»¤ê°€ í•˜ë‚˜ì˜ threadë¥¼ ê°€ì§„ë‹¤.
- Shared worker(ê³µìœ  ì›Œì»¤): ì—¬ë˜ ê°œì˜ ì›Œì»¤ê°€ í•˜ë‚˜ì˜ background processë¥¼ ê³µìœ í•œë‹¤. ê³µìœ  ì›Œì»¤ëŠ” `port`ê°ì²´ë¥¼ í†µí•´ í†µì‹ ì„ í•œë‹¤.

## ì‚¬ìš©í•´ë³´ê¸°

ë§¨ ìœ„ì˜ ì˜ˆì‹œì—ì„œ workerë¥¼ ì‚¬ìš©í•´ë³´ì.

```js
const start = new Date();
const timeout = 2000;

setTimeout(() => {
  console.log(`from timeout ${new Date() - start}`);
}, timeout);

const worker = new Worker("worker.js");
worker.postMessage({ start, timeout });
worker.onmessage = (msg) => {
  console.log(`from worker ${msg.data}`);
  worker.terminate();
};

while (new Date() - start < 3000);
```

```js
// worker.js
self.onmessage = (msg) => {
  const start = new Date();
  setTimeout(() => {
    self.postMessage(new Date() - start);
  }, msg.data.timeout);
};
```

ê²°ê³¼ë¡œ `from timeout 3002`, `from worker 2002`ê°€ ìˆœì„œëŒ€ë¡œ ì¶œë ¥ëë‹¤. 

í•œê°€ì§€ ì£¼ì˜í•´ì•¼ í•  ì ì´ ìˆëŠ”ë°, workerì˜ ìƒì„±ì€ ë¹„ë™ê¸°ì ì´ë¼ëŠ” ê²ƒì´ë‹¤. Workerë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì½ì–´ì•¼í•˜ê¸° ë•Œë¬¸ì´ë‹¤. Workerë¥¼ ìƒì„±í•˜ëŠ” ë™ì•ˆ ì „ë‹¬ëœ ë©”ì‹œì§€ëŠ” port message queueì— ì €ì¥ëœë‹¤.

ì´ëŸ° ì‚¬ìš©ì˜ˆì‹œ ì™¸ì—ë„ ì•„ë˜ì™€ ê°™ì€ ì‘ì—…ì„ í•  ë•Œ workerì˜ ì‚¬ìš©ì„ ê³ ë ¤í•  ìˆ˜ ìˆë‹¤.
- ë§¤ìš° ë§ì€ ë¬¸ìì—´ì˜ Encoding/Decoding, ë³µì¡í•œ ìˆ˜í•™ ê³„ì‚°(ì†Œìˆ˜prime numbers, ì•”í˜¸í™” ë“±)
- ë§¤ìš° í° ë°°ì—´ì˜ ì •ë ¬
- ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•œ ë°ì´í„° ì²˜ë¦¬
- ì´ë¯¸ì§€ ì²˜ë¦¬â€¢ ë¹„ë””ì˜¤ë‚˜ ì˜¤ë””ì˜¤ ë°ì´í„° ì²˜ë¦¬
- UI ìŠ¤ë ˆë“œë¥¼ ë°©í•´í•˜ì§€ ì•Šê³  ì§€ì†ì ìœ¼ë¡œ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì‘ì—…
- ê¸°íƒ€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì˜¤ëœ ì‹œê°„ ì‘ì—…í•´ì•¼ í•˜ëŠ” ê²½ìš°

## ì°¸ì¡°

- [MDN - ì›¹ ì›Œì»¤ ì‚¬ìš©í•˜ê¸°](https://developer.mozilla.org/ko/docs/Web/API/Web_Workers_API/Using_web_worker)
- https://tech.kakao.com/2021/09/02/web-worker/
- https://darrengwon.tistory.com/1171
- [stackoverflow - The JavaScript Event Loop and Web Workers](https://stackoverflow.com/questions/41125303/the-javascript-event-loop-and-web-workers)
- [stackoverflow - are messages sent via worker.postMessage() queued?](https://stackoverflow.com/questions/34409254/are-messages-sent-via-worker-postmessage-queued)
