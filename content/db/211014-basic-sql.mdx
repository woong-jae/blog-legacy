---
title: "Basic SQL"
date: "2021-10-14"
emoji: "ğŸ–¨"
category: "db"
---
## SQLì˜ ìŠ¤í‚¤ë§ˆì™€ ì¹´íƒˆë¡œê·¸ ê°œë…(DDL)
### SQL Schema(=database)
ê°™ì€ ë°ì´í„°ë² ì´ìŠ¤ì— ì†í•˜ëŠ” **í…Œì´ë¸”ì´ë‚˜ ë‹¤ë¥¸ êµ¬ì¡°ë“¤ì„ ë¬¶ê¸° ìœ„í•œ ê°œë…**ì´ë‹¤. Schema nameì— ì˜í•´ êµ¬ë¶„ëœë‹¤.

ìŠ¤í‚¤ë§ˆì˜ ì†Œìœ ìë¥¼ ë‚˜íƒ€ë‚´ëŠ” 'authorization identifier'ì™€ ìŠ¤í‚¤ë§ˆì˜ ê° ìš”ì†Œì— ëŒ€í•œ 'descriptor'(ê¸°ìˆ ì)ë¥¼ í¬í•¨í•œë‹¤.

`CREATE TABLE`ë¡œ ìŠ¤í‚¤ë§ˆë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.
```sql
CREATE SCHEMA COMPANY AUTHORIZATION 'Joshua';
```
ìŠ¤í‚¤ë§ˆëŠ” ê¶Œí•œì´ ìˆëŠ” ìœ ì €ë§Œì´ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

#### Catalog
ìŠ¤í‚¤ë§ˆì˜ ëª¨ìŒì´ë‹¤. 

`INFORMATION_SCHEMA`ë¼ëŠ” íŠ¹ë³„í•œ ìŠ¤í‚¤ë§ˆë¥¼ í•­ìƒ ê°€ì§€ê³  ìˆë‹¤. `INFORMATION_SCHEMA`ëŠ” catalog ì•ˆì˜ ëª¨ë“  ìŠ¤í‚¤ë§ˆì™€ ê° ìŠ¤í‚¤ë§ˆì˜ ëª¨ë“  ìš”ì†Œ ì„œìˆ ìì— ëŒ€í•œ ì •ë³´ë¥¼ ì œê³µí•œë‹¤.

ê°™ì€ catalog ì•ˆì˜ ìŠ¤í‚¤ë§ˆë¼ë¦¬ë§Œ integirity constraintë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤.

> ê°™ì€ catalogì— ì†í•œ ìŠ¤í‚¤ë§ˆëŠ” type/domain ì •ì˜ì™€ ê°™ì€ íŠ¹ì • ìš”ì†Œë¥¼ ê³µìœ í•  ìˆ˜ ìˆë‹¤.

### CREATE TABLE
ìƒˆë¡œìš´ relation $R$ì„ ì •ì˜í•œë‹¤. $R$ì— ì´ë¦„ì„ ì£¼ê³  attribute, types(domains), ê·¸ë¦¬ê³  ì´ˆê¸° ì œì•½ì¡°ê±´(`NOT NULL`, `UNIQUE` ë“±)ë“¤ì„ ëª…ì‹œí•œë‹¤.

Key, entity ë¬´ê²°ì„±, referential ë¬´ê²°ì„± ì œì•½ì¡°ê±´ë“¤ì€ attribute ì„ ì–¸ ì´í›„ ê¸°ìˆ í•œë‹¤. ì œì•½ì¡°ê±´ë“¤ì€ í…Œì´ë¸” ìƒì„± í›„ì—ë„ `ALTER TABLE`ì„ í†µí•´ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤.

***í…Œì´ë¸”ì˜ ì¢…ë¥˜:***
- **Base tables(base relations)**  
    Tableê³¼ tableì˜ í–‰ë“¤ì´ DBMSì— ì‹¤ì œë¡œ ì¡´ì¬í•œë‹¤.

- **Virtual relations(views)**  
    ë¬¼ë¦¬ì ì¸ íŒŒì¼ì— ì‹¤ì œë¡œ ì¡´ì¬í•  ìˆ˜ë„, ì•ˆí•  ìˆ˜ë„ ìˆë‹¤. `CREATE VIEW`ë¥¼ í†µí•´ ìƒì„±í•  ìˆ˜ ìˆë‹¤.  
    Viewì— í•´ë‹¹í•˜ëŠ” íŠœí”Œë“¤ì€ **êµ¬ì²´í™”(materialized)ë˜ì–´ ìˆì§€ ì•Šì€ ì´ìƒ ì°¸ì¡°ë  ë•Œ ê³„ì‚°**ëœë‹¤.  
    \***ì¥ì :**\*
    - Space ë‚­ë¹„ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.
    - ê¶Œí•œì„ ì œí•œí•  ìˆ˜ ìˆë‹¤.
    - Viewì˜ ê³„ì‚°ì´ ì¶©ë¶„íˆ ë¹¨ë¼ ë³„ë„ì˜ í…Œì´ë¸”ì´ í•„ìš” ì—†ì„ ë•Œ ìœ ìš©í•˜ë‹¤.

### SQLì˜ attribute ë°ì´í„° íƒ€ì…ê³¼ ë„ë©”ì¸
- **Numeric**: `INT`, `SMALLINT`, ì˜¤ë¼í´ì—ì„œëŠ” `NUMBER`
    - Floating point: `FLOAT`, `REAL`, `DOUBLE PRECISION`  
    - Formated number: `DECIMAL(i, j)`  
        $i$: the precision, ì´ ìë¦¿ìˆ˜ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤  
        $j$: the scale, ì†Œìˆ«ì  ì•„ë˜ ìë¦¿ìˆ˜ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤
    
- **Character-strings**:
    - ê³ ì • ê¸¸ì´: `CHAR(n)`, `CHARACTER(n)`. në³´ë‹¤ ì§§ìœ¼ë©´ ìš°ì¸¡ìœ¼ë¡œ ê³µë°±ì´ ì±„ì›Œì§„ë‹¤.
    - ê°€ë³€ ê¸¸ì´: `VARCHAR(n)`, `CLOB(Character Large Object)`: í° text ê°’ë“¤ì„ ì €ì¥í•  ìˆ˜ ìˆë‹¤.

> **varcharê³¼ varchar2ì˜ ì°¨ì´ì **:
>
> varcharì€ ms-sqlì—ì„œ ì‚¬ìš©í•˜ëŠ” í˜•ì‹ì´ê³  varchar2ëŠ” ì˜¤ë¼í´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ë‹¤.
>
> ì˜¤ë¼í´ì—ì„œë„ varcharì„ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ì˜¤ë¼í´ì˜ ê³µì‹ ë¬¸ì„œì— ë”°ë¥´ë©´ varcharëŠ” ë‚˜ì¤‘ì— ë‹¤ë¥¸ ë°ì´í„° íƒ€ì…ìœ¼ë¡œ ë³€ê²½ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— varchar2ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤ê³  í•œë‹¤.

- **Boolean**: `TRUE`, `FALSE`, `NULL`

- **Date**: 'yy-mm-dd'í˜•ì‹ìœ¼ë¡œ ë‚ ì§œë¥¼ í‘œí˜„í•œë‹¤. ì˜¤ë¼í´ì—ì„œëŠ” `to_date()`ë¡œ ì‚¬ìš©í•œë‹¤.

- **Time**: 'HH:MM:SS'

- **Timestamp**: 'Date + Time + decimal fractions of seconds' ì˜ˆ) '2021-10-14 15:25:14.658302'

- **Interval**: Date, Time, Timestampì˜ ì¦ê°€, ê°ì†Œì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìƒëŒ€ì ì¸ ê°’ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

- **Domain**: ë„ë©”ì¸ì„ ì •ì˜í•  ìˆ˜ ìˆë‹¤. ì‚¬ìš©í–ˆì„ ë•Œ ì–»ì„ ìˆ˜ ìˆëŠ” ì¥ì ìœ¼ë¡œ 1)ë„ë©”ì¸ì˜ ë°ì´í„° íƒ€ì…ì„ ì‰½ê²Œ ë³€ê²½í•  ìˆ˜ ìˆê³  2)ìŠ¤í‚¤ë§ˆì˜ ê°€ë…ì„±ì´ ë†’ì•„ì§„ë‹¤.
```sql
CREATE DOMAIN SSN_TYPE AS CHAR(9);
```
- **Type**: ê°ì²´ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë‹¤.

[ì˜¤ë¼í´ì´ ì œê³µí•˜ëŠ” ë°ì´í„° íƒ€ì… ë³´ê¸°](https://docs.oracle.com/database/121/SQLRF/sql_elements001.htm#SQLRF30020)

### SQLì—ì„œ ì œì•½ì¡°ê±´ ì§€ì •í•˜ê¸°
- **Attributeì— ëŒ€í•œ ì œì•½ì¡°ê±´**: `DEFAULT`, `NOT NULL`, `CHECK`(domain ì œì•½ì¡°ê±´)
```sql
Age INT NOT NULL CHECK (Age >= 15 and Age < 65)
```

- **Key ì œì•½ì¡°ê±´**:  
    - `PRIMARY KEY`
    - `UNIQUE`: Candidate key(í›„ë³´ í‚¤)ë¥¼ ëª…ì‹œí•  ìˆ˜ ìˆë‹¤.  
    - `FOREIGN KEY`: `SET NULL`, `CASCADE` ê°™ì€ **'ì°¸ì¡° íŠ¸ë¦¬ê±° ì•¡ì…˜ ì ˆ'**ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ í†µí•´ ì¼ê´€ì„±ì„ ë³´ì¥í•  ìˆ˜ ìˆë‹¤. DefaultëŠ” rejectë‹¤.
```sql
FOREIGN KEY (TimelineRno) REFERENCES ROOM(RoomNumber) ON DELETE CASCADE
```

<br/>

## ê¸°ë³¸ ê²€ìƒ‰ ì¿¼ë¦¬
```sql
SELECT  <attribute list>
FROM    <relation list>
[WHERE  <condition>]
-- for aggregates
[GROUP BY   <attribute list>]
[HAVING     <condition>]
[ORDER BY   <attribute list> [DESC]];
```
**`SELECT`(projection)**: **SQLì—ì„œëŠ” íŠœí”Œì˜ ì¤‘ë³µì´ í—ˆìš©**ë˜ì§€ë§Œ relation calculus/algebraì—ì„œëŠ” ì¤‘ë³µì´ í—ˆìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.

**`WHERE`(selection)**: Conditional(boolean) í‘œí˜„ìœ¼ë¡œ ì–´ëŠ íŠœí”Œì„ ê°€ì ¸ì˜¬ì§€ ì •í•œë‹¤. ì—¬ëŸ¬ relationì´ ìˆìœ¼ë©´ 'join' conditionì„ í¬í•¨í•œë‹¤.
    `WHERE`ì ˆ ìƒëµì‹œ ê°€ëŠ¥í•œ ëª¨ë“  íŠœí”Œë“¤ì˜ ì¡°í•©ì„ ë§Œë“ ë‹¤.

> SQL ì§ˆì˜ëŠ” ë°ì´í„°ë¥¼ 'ì–´ë–»ê²Œ' ì°¾ì•„ì˜¤ë¼ê³  í•˜ì§€ ì•Šê³  'ë¬´ìŠ¨ ë°ì´í„°'ë¥¼ ì›í•˜ëŠ”ì§€ ê¸°ìˆ í•œë‹¤. ì¦‰, **ë¹„ì ˆì°¨ì (non-procedural)ì´ê³  ì„ ì–¸ì (declaritive)**ì´ë‹¤.

## í…Œì´ë¸”ì„ ì¡°í•©ìœ¼ë¡œ ë‹¤ë£¨ê¸°
SQLì—ì„œëŠ” ì¤‘ë³µëœ íŠœí”Œì„ ì œê±°í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
- ì¤‘ë³µ ì œê±°ëŠ” ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ì—°ì‚°ì´ë‹¤.
- ìœ ì €ê°€ ì¤‘ë³µëœ ê²°ê³¼ë¥¼ ë³´ê³ ì‹¶ì„ ìˆ˜ë„ ìˆë‹¤.
- Aggregate ê¸°ëŠ¥ë“¤(`AVG`, `SUM` ë“±)ì„ ì‚¬ìš©í•  ë•Œ ì¤‘ë³µ ì œê±°ë¥¼ ì›í•˜ì§€ ì•Šì„ ë•Œê°€ ë§ë‹¤.

ì¤‘ë³µ ì œê±°ë¥¼ ì›í•œë‹¤ë©´ `SELECT`ì—ì„œ `DISTINCT`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

### Set operations
- `UNION`: í•©ì§‘í•©
- `EXCEPT`(ì˜¤ë¼í´ì—ì„œ `MINUS`): ì°¨ì§‘í•©
- `INTERSECT`: êµì§‘í•©
```sql
-- ì„±ì´ 'Smith'ì¸ ì§ì›ì´ ì°¸ì—¬í•˜ëŠ” í”„ë¡œì íŠ¸ ì¤‘, 
-- ê·¸ ì§ì›ì´ ì¼í•˜ëŠ” ì‚¬ëŒì´ê±°ë‚˜ ë§¤ë‹ˆì €ì¸ ëª¨ë“  í”„ë¡œì íŠ¸ì˜ ë²ˆí˜¸ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
(
    SELECT DISTINCT Pnumber
    FROM    PROJECT, WORKS_ON, EMPLOYEE
    WHERE   Pnumber = Pno AND Essn = Ssn AND Lname = 'Smith'
)
UNION
(
    SELECT DISTINCT Pnumber
    FROM    PROJECT, DEPARTMENT, EMPLOYEE
    WHERE   Dnum = Dnumber AND Mgr_ssn = Ssn AND Lname = 'Smith'
);
```

Set operationì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë‘ í…Œì´ë¸”ì´ **'type-compatible'** í•´ì•¼í•œë‹¤.
> **Type-compatible**: ë‘ relationì´ 1)ê°™ì€ attributeë“¤ì„ ê°€ì§€ê³  2)attributeë“¤ì˜ ìˆœì„œê°€ ê°™ì•„ì•¼ í•œë‹¤.

## SQLì´ ì œê³µí•˜ëŠ” ì¶”ê°€ ê¸°ëŠ¥
- Substring Pattern Matching  
    `LIKE`
    - '%': ì„ì˜ì˜ ìˆ˜ì˜ 0ê°œ ì´ìƒì˜ ë¬¸ìë¥¼ ëŒ€ì²´í•œë‹¤.
    - '_': ë‹¨ì¼ ë¬¸ìë¥¼ ëŒ€ì²´í•œë‹¤.
```sql
-- ì§ì›ë“¤ì¤‘ 60ë…„ìƒì˜ ì´ë¦„ê³¼ ìƒì¼ ê°€ì ¸ì˜¤ê¸°
SELECT  Fname, Lname, Bdate 
FROM    employee 
[WHERE   to_char(Bdate, 'yyyy-mm-dd') LIKE '196_-__-__'];
[WHERE   to_char(Bdate, 'yyyy-mm-dd') LIKE '196%']; 
```
- Arithmatic operations: `SELECT` ì ˆì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

- Ordering: `DESC`(ë‚´ë¦¼ì°¨ìˆœ), by default `ASC`(ì˜¤ë¦„ì°¨ìˆœ)