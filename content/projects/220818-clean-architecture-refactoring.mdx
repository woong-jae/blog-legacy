---
title: "Clean Architecture ì ìš©ê¸°"
date: "2022-08-18 17:47"
emoji: "ğŸ§½"
category: "projects"
---

## ê¸°ì¡´ êµ¬ì¡°
`/src/api/index.js` íŒŒì¼ì—ì„œ ëª¨ë“  APIë“¤ì„ ê´€ë¦¬í–ˆë‹¤. ê°œë³„ APIë“¤ì„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ëŒì–´ë‹¤ ì“°ë‹¤ë³´ë‹ˆ, ë¡œì§ì´ APIë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ë¡œ ì‚°ê°œëë‹¤. ì´ëŸ° ìƒí™©ì—ì„œ APIì— ë­”ê°€ ë³€ê²½ì´ ìƒê²¼ì„ ë•Œ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤. ë³€ê²½ëœ APIë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¾ì•„ì•¼í•˜ê³ , ê·¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¡œì§ì„ ë³€ê²½í•´ì•¼í–ˆë‹¤. ë­”ê°€ ë§ì§€ ì•Šë‹¤... ë³€ê²½ì´ ì–´ë ¤ìš°ë©´ ì½”ë“œë¥¼ ë¦¬íŒ©í„°ë§ í•´ì•¼í•œë‹¤ëŠ” ì‹ í˜¸ë¼ê³  ìµœê·¼ ì±…(Refactoring 2rd edition)ì—ì„œ ì½ì—ˆë‹¤.

ê·¸ëŸ¼ ë³€ê²½í•˜ê¸° ì‰¬ìš´ ì½”ë“œëŠ” ë­˜ê¹Œ? ê²€ìƒ‰ì„ í•´ë³´ë‹¤ê°€ [Uncle Bob's clean architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)ë¥¼ ë§Œë‚¬ë‹¤. ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ë¡œ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì—¬ëŸ¬ ë ˆì´ì–´ë¡œ ë‚˜ëˆ„ëŠ” ì„¤ê³„ ë°©ì‹ì´ë‹¤. í”„ë ˆì„ì›Œí¬, UI, DB ë“±ìœ¼ë¡œë¶€í„° ë…ë¦½ì ì¸ ì‹œìŠ¤í…œì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤ëŠ” ì†Œê°œë¥¼ ë³´ìë§ˆì "ì´ê±°ë‹¤"ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.

![clean-architecture.png|500](https://blog.cleancoder.com/uncle-bob/images/2012-08-13-the-clean-architecture/CleanArchitecture.jpg)

ë¸”ë¡œê·¸ì— ë”°ë¥´ë©´, í´ë¦° ì•„í‚¤í…ì³ëŠ” ê´€ì‹¬ì‚¬ì— ë”°ë¼ ê³„ì¸µì„ ë‚˜ëˆ„ê³ , ì„¸ë¶€ êµ¬í˜„ì´ ì•„ë‹Œ ë„ë©”ì¸ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ê³„í•œë‹¤. ê·¸ë¦¬ê³  ë„ë©”ì¸ì€ í”„ë ˆì„ì›Œí¬ë‚˜ DB, UI ë“± ì™¸ë¶€ ìš”ì†Œì— ì˜ì¡´í•˜ì§€ ì•Šë„ë¡ í•œë‹¤. ê·¸ë¦¬ê³  ì´ ì•„í‚¤í…ì³ê°€ ë™ì‘í•˜ê¸° ìœ„í•´ì„œëŠ” **ì˜ì¡´ì„± ê·œì¹™**ì„ ì§€ì¼œì•¼ í•œë‹¤.

ì˜ì¡´ì„± ê·œì¹™ì€ ëª¨ë“  ì†ŒìŠ¤ì½”ë“œì˜ ì˜ì¡´ì„±ì€ ì™¸ë¶€ì—ì„œ ë‚´ë¶€ë¡œ, ì¦‰, ê³ ìˆ˜ì¤€ì—ì„œ ì €ìˆ˜ì¤€ìœ¼ë¡œ í–¥í•´ì•¼ í•œë‹¤ëŠ” ê·œì¹™ì´ë‹¤. ì—…ë¬´ì˜ ë¡œì§ì— í•´ë‹¹í•˜ëŠ” ì½”ë“œë“¤ì´ React ê°™ì€ í”„ë ˆì„ì›Œí¬ì— ì˜ì¡´í•´ì„œëŠ” ì•ˆëœë‹¤ëŠ” ê²ƒì´ë‹¤.

ë‚´ê°€ ì‘ì„±í•œ ì½”ë“œëŠ” ì´ ê·œì¹™ì„ ì™„ì „íˆ ë¬´ì‹œí•˜ê³  ìˆì—ˆë‹¤. ì»´í¬ë„ŒíŠ¸ì— ë¡œì§ì´ í•©ì³ì¡Œë‹¤. UIì— UseCaseì™€ Presenterê°€ í•©ì³ì§„ ê²ƒì´ë‹¤. ì„œë¡œ ê°•í•œ ì˜ì¡´ì„±ì„ ê°€ì§€ê³ , í•˜ë‚˜ê°€ ë³€ê²½ë˜ë©´ ë‚˜ë¨¸ì§€ ëª¨ë‘ê°€ ì˜í–¥ì„ ë°›ëŠ”ë‹¤.

## ë¦¬íŒ©í„°ë§
ë‚˜ëŠ” í´ë¦° ì•„í‚¤í…ì³ì™€ ì—¬ëŸ¬ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¦¬íŒ©í„°ë§ì„ ì‹œì‘í–ˆë‹¤.
> **Reference**
> * [react-with-clean-architecture](https://github.com/falsy/react-with-clean-architecture)  
> * [íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ í”„ë¡œì íŠ¸ë¥¼ ìœ„í•œ ê¶ê·¹ì ì¸ í´ë¦° ì•„í‚¤í…ì²˜ í…œí”Œë¦¿](https://velog.io/@lky5697/the-ultimate-clean-architecture-template-for-typescript-projects?utm_source=substack&utm_medium=email#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EB%B0%8F-%EB%A3%A8%ED%8A%B8-%EC%83%9D%EC%84%B1)

ì•„ë˜ì™€ ê°™ì€ ì—­í• ì„ í•˜ëŠ” ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í–ˆë‹¤.
- `core`: Entities, usecasesì™€ ê°™ì€ ë„ë©”ì¸ë“¤ì„ í¬í•¨í•œë‹¤.
- `data`: Repositories, presentersì™€ ê°™ì€ ì–´ëí„°ë“¤ì„ í¬í•¨í•œë‹¤.
- `di`: ì½”ì–´ì— ë°ì´í„°ë¥¼ ì£¼ì…í•œë‹¤.

ì´ ë””ë ‰í† ë¦¬ êµ¬ì¡°ì— ìœ ì € ì•„ì´ë””ì™€ í† í°ì— ê´€ë ¨ëœ `Auth`ë¥¼ ë¶„ë¦¬í•´ë³´ê² ë‹¤.
1. `src/api/index.js`ì—ì„œ use caseë¡œ ë¶„ë¦¬í•˜ê¸°
ë¨¼ì € authì™€ ê´€ë ¨ëœ `api`ë¡œëŠ” `login`ì´ë¼ëŠ” APIê°€ ìˆì—ˆë‹¤. ì´ APIëŠ” `login`ì´ë¼ëŠ” use caseë¡œ ë¹¼ëƒˆê³ , use caseì—ì„œ ì œê³µí•  ë°ì´í„°ëŠ” `IAuthEntity`ë¡œ ì •ì˜í–ˆë‹¤.

ê·¸ ë‹¤ìŒìœ¼ë¡œëŠ” authì™€ ê´€ë ¨ëœ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì„ ì‚´í´ë´¤ë‹¤. ì¶”ê°€ì ìœ¼ë¡œ `logout`, `getToken` ìœ ì¦ˆ ì¼€ì´ìŠ¤ë¥¼ ë°œê²¬í–ˆë‹¤.

`core/useCases/interfaces/iAuth.ts`ì— ë°œê²¬í•œ ìœ ì¦ˆ ì¼€ì´ìŠ¤ë“¤ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜í–ˆë‹¤. `core/entities/interfaces/iAuth.ts`ì—ëŠ” ì—”í‹°í‹°ë¥¼ ì •ì˜í–ˆë‹¤.

```ts
// core/entities/interfaces/iAuth.ts
export interface IAuthEntity {
	id: string;
	token: string;
}

// core/useCases/interfaces/iAuth.ts
export default interface IAuthUseCase {
	login(code: string): Promise<IAuthEntity>;
	logout(): void;
	getToken(): string | null;
}
```

2. Use case êµ¬í˜„í•˜ê¸°
ìœ„ì—ì„œ ì •ì˜í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ `core/useCases/Auth.ts`ì— êµ¬í˜„í–ˆë‹¤. êµ¬í˜„í•˜ë©´ì„œ auth ì •ë³´ë¥¼ ë°›ì„ repositoryê°€ í•„ìš”í•´ì¡Œë‹¤. í•„ìš”í•œ repositoryëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ `core/useCases/repository-interfaces`ì— ì •ì˜í•´ ì‚¬ìš©í–ˆë‹¤.

```ts
// core/useCases/Auth.ts
export default class AuthUseCase implements IAuthUseCase {
	constructor(private readonly authRepo: IAuthRepository) {}

	getToken(): string | null {
		return this.authRepo.getToken();
	}

	async login(code: string): Promise<IAuthDTO> {
		return await this.authRepo.login(code);
	}

	logout() {
		this.authRepo.logout();
	}
}
// core/useCases/repository-interfaces
export default interface IAuthRepository {
	login(code: string): Promise<IAuthDTO>;
	logout(): void;
	getToken(): string | null;
}
```

Repository interfaceë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” **ì˜ì¡´ì„± ê·œì¹™ì„ ì§€í‚¤ê¸° ìœ„í•´**ì„œë‹¤. ìœ ì¦ˆ ì¼€ì´ìŠ¤ê°€ ë ˆí¬ì§€í† ë¦¬ë¥¼ ì§ì ‘ì°¸ì¡°í•˜ë©´ ì˜ì¡´ì„± ê·œì¹™ì„ ìœ„ë°˜í•˜ê²Œ ëœë‹¤. ìœ ì¦ˆì¼€ì´ìŠ¤ê°€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì°¸ì¡°, êµ¬ì²´ì ì¸ `AuthRepository`ê°€ ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë©´ ì˜ì¡´ì„±ì„ ì—­ì „ì‹œí‚¬ ìˆ˜ ìˆì–´ ì˜ì¡´ì„± ê·œì¹™ì„ ì§€í‚¬ ìˆ˜ ìˆë‹¤.

3. Repository êµ¬í˜„í•˜ê¸°
`IAuthRepository`ì˜ ì„¸ë¶€ì‚¬í•­ì„ `data/repositories/Auth.ts`ì— êµ¬í˜„í–ˆë‹¤.
```ts
export default class AuthRepository implements IAuthRepository {
	constructor(private readonly storage: iStorage) {}
	
	async login(code: string): Promise<IAutoDTO> {
		const authDTO = await HTTP.get(`/user/login?code=${code}`).then(
			({ data }) => new AuthDTO(data)
		);
		this.storage.set(authDTO);
	
		return authDTO;
	}
	
	logout() {
		this.storage.remove();
	}
	
	getToken(): string | null {
		const auth = this.storage.get();
		return auth ? auth.token : null;
	}
}
```

4. Presenter êµ¬í˜„í•˜ê¸°
ìœ„ì— í–ˆë˜ ê³¼ì •ê³¼ ë¹„ìŠ·í•˜ê²Œ Presenterë¥¼ êµ¬í˜„í–ˆë‹¤. UIëŠ” presenterë¡œ authì— ì ‘ê·¼í•˜ê²Œ ëœë‹¤.
```ts
export default class AuthPresenter implements IAuthPresenter {
	constructor(private readonly useCase: IAuthUseCase) {}

	async login(code: string): Promise<IAuthEntity> {
		return await this.useCase.login(code);
	}
	
	logout(): void {
		this.useCase.logout();
	}
	
	getToken(): string | null {
		return this.useCase.getToken();
	}
}
```

5. ì˜ì¡´ì„± ì£¼ì…í•˜ê¸°
ì´ì œ ë§ˆì§€ë§‰ ë‹¨ê³„ë‹¤. `di/Auth.ts`ì—ì„œ Presenterì— í•„ìš”í•œ ëª¨ë“  ì˜ì¡´ì„±ì„ ì£¼ì…í•œë‹¤. React ì»´í¬ë„ŒíŠ¸ëŠ” ì´ì œ ì´ presenterì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤.
```ts
// ...
const authRepo = new AuthRepository(new TypeStorage<IAuthDTO>("auth", localStorage));
const authUseCase = new AuthUseCase(authRepo);
const Auth = new AuthPresenter(authUseCase);

export default Auth;
```

ì´ë ‡ê²Œ UIë¡œë¶€í„° authë¥¼ ë¶„ë¦¬í•´ëƒ„ìœ¼ë¡œì¨ ì»´í¬ë„ŒíŠ¸ëŠ” UIì—ë§Œ ì‹ ê²½ì“¸ ìˆ˜ ìˆê³ , ë„ë©”ì¸ì€ ë„ë©”ì¸ì—ë§Œ ì‹ ê²½ì“¸ ìˆ˜ ìˆê²Œ ëë‹¤. 
í™•ì‹¤íˆ ì½”ë“œ ê°€ë…ì„±ì´ ì¢‹ì•„ì¡Œë‹¤ëŠ”ê²Œ ëŠê»´ì¡Œë‹¤. ì´ì œ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ê±°ì˜ UIì— ê´€í•œ ì½”ë“œë§Œ ë‚¨ê²Œ ëë‹¤.

ë‹¤ìŒ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì²˜ìŒë¶€í„° ì´ëŸ° êµ¬ì¡°ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ê³  ì‹¶ë‹¤. ìœ„ì— ì ì€ê±´ auth í•˜ë‚˜ ë¿ì´ì§€ë§Œ, ì‹¤ì œ ì½”ë“œì—ì„œëŠ” 4~5ê°œ ë” ë¹¼ëƒˆë‹¤. 
ì•„ëŠ”ê²Œ ë§ì•„ì•¼ ëª¸ì´ ëœ ê³ ìƒí•˜ëŠ” ê²ƒ ê°™ë‹¤. ì²˜ìŒ ì ìš©í•´ë´ì„œ ë­ê°€ ë§ëŠ”ì§€ í‹€ë¦°ì§€ ëª¨ë¥´ê² ì§€ë§Œ ì¼ë‹¨ì€ ì¢‹ë‹¤!

(ë­”ê°€ ì´ìƒí•˜ê±°ë‚˜ í‹€ë¦° ì ì´ ë³´ì¸ë‹¤ë©´ ì•Œë ¤ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤ ğŸ™Œ)