---
title: "Yarn PnP ì˜ì¡´ì„± ì—ëŸ¬ í•´ê²°ê¸°"
date: "2022-07-11 18:12"
emoji: "ğŸ”Œ"
category: "projects"
---

## ë°œë‹¨
í”„ë¡œì íŠ¸ì—ì„œ `react-codemirror`ë¥¼ ì‚¬ìš©í•˜ë ¤ê³  ì˜ì¡´ì„±ì„ ì„¤ì¹˜í–ˆë‹¤.

```sh
yarn add @codemirror/lang-javascript @uiw/react-codemirror
```

ê·¸ë¦¬ê³  ì˜ˆì œ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.

```sh
Module not found: Error: @uiw/react-codemirror tried to access @codemirror/view (a peer dependency) but it isn't provided by your application; this makes the require call ambiguous and unsound.
Required package: @codemirror/view
```

ì˜ì¡´ì„±ì„ ì°¾ì§€ ëª»í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ë˜ì„œ ë¹„ìŠ·í•œ ì—ëŸ¬ê°€ ìˆë‚˜ ì°¾ì•„ë´¤ëŠ”ë°, ì˜ì¡´ì„± íŒ¨í‚¤ì§€ê°€ ì˜ì¡´í•˜ëŠ” íŒ¨í‚¤ì§€ë¥¼ ì½”ë“œì—ì„œ `import` í•  ë•Œ í•´ë‹¹ íŒ¨í‚¤ì§€ë¥¼ ì°¾ì§€ ëª»í•˜ëŠ” ë¬¸ì œê°€ ì¢…ì¢… ë°œìƒí•œë‹¤ëŠ” ê²ƒì„ ì•Œê²Œëë‹¤.
í•˜ì§€ë§Œ, ì´ìœ ëŠ” ì í˜€ìˆì§€ ì•Šì•„ì„œ ì§ì ‘ íŒ¨í‚¤ì§€ì˜ ì½”ë“œë¥¼ í™•ì¸í•´ë´¤ë‹¤.

## ê³¼ì •
PnP ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê³  ìˆì—ˆê¸° ë•Œë¬¸ì— íŒ¨í‚¤ì§€ì˜ ì½”ë“œë¥¼ ë³´ê¸° ìœ„í•´ì„œëŠ” ë¨¼ì € íŒ¨í‚¤ì§€ë¥¼ `unplug` í•´ì¤˜ì•¼ í•œë‹¤.

```sh
yarn unplug @uiw/react-codemirror
```

ê·¸ëŸ¬ë©´ `.yarn/cache/unplugged` í´ë”ì— ì••ì¶• í•´ì œëœ íŒ¨í‚¤ì§€ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤. 

ë¬´ìŠ¨ ì˜ì¡´ì„±ì´ ë¬¸ì œì¸ì§€ ë³´ê¸° ìœ„í•´ `package.json` íŒŒì¼ê³¼ ì—ëŸ¬ì—ì„œ ì•Œë ¤ì¤€ íŒŒì¼ì¸ `@uiw/react-codemirror/esm/basicSetup.js`ì˜ `import` ë¶€ë¶„ì„ ë´¤ë‹¤.

```json
// ...
    "peerDependencies": {
        "@babel/runtime": ">=7.11.0",
        "@codemirror/theme-one-dark": ">=6.0.0",
        "@codemirror/view": ">=6.0.0",
        "codemirror": ">=6.0.0",
        "react": ">=16.8.0",
        "react-dom": ">=16.8.0"
    },
    "dependencies": {
        "@babel/runtime": ">=7.11.0",
        "@codemirror/theme-one-dark": "^6.0.0",
        "codemirror": "^6.0.0"
    },
// ...
```

```js
import { lineNumbers, highlightActiveLineGutter, highlightSpecialChars, drawSelection, dropCursor, rectangularSelection, crosshairCursor, highlightActiveLine, keymap } from '@codemirror/view';
import { EditorState } from '@codemirror/state';
import { history, defaultKeymap, historyKeymap } from '@codemirror/commands';
import { highlightSelectionMatches, searchKeymap } from '@codemirror/search';
import { closeBrackets, autocompletion, closeBracketsKeymap, completionKeymap } from '@codemirror/autocomplete';
import { foldGutter, indentOnInput, syntaxHighlighting, defaultHighlightStyle, bracketMatching, foldKeymap } from '@codemirror/language';
import { lintKeymap } from '@codemirror/lint';
```

ë¬¸ì œì ì´ ë³´ì¸ë‹¤! íŒŒì¼ì—ì„œëŠ” `@codemirror/state`, `@codemirror/commands`ë“±ì„ `import`í•˜ëŠ”ë°, `package.json`ì˜ ì˜ì¡´ì„±ì—ëŠ” ëª…ì‹œë˜ì–´ ìˆì§€ ì•Šë‹¤.
ì›ë˜ëŠ” `codemirror`ë¥¼ ì„¤ì¹˜í•¨ìœ¼ë¡œì¨ ì´ ì˜ì¡´ì„±ë“¤ì„ ì§ì ‘ ëª…ì‹œí•˜ì§€ ì•Šì•„ë„ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ë°, PnPì˜ strict mode ë•Œë¬¸ì— ëª…ì‹œí•˜ì§€ ì•Šì€ ì˜ì¡´ì„±ì— ì ‘ê·¼í•˜ë ¤ í•´ì„œ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²ƒ ê°™ë‹¤.

ë¬¸ì œì˜ ì›ì¸ì„ ì°¾ì•˜ìœ¼ë‹ˆ ì´ì œëŠ” í•´ê²°ë²•ì„ ì°¾ì•„ì•¼ í•œë‹¤.

ì²˜ìŒì—ëŠ” stack overflow, github issueì—ì„œ ë¹„ìŠ·í•œ ì—ëŸ¬ë¥¼ ì–´ë–»ê²Œ í•´ê²°í–ˆëŠ”ì§€ ì°¾ì•„ë‹¤ë…”ëŠ”ë‹¤.
ì—¬ê¸°ì„œ ì–»ì€ í•´ê²°ë²•ì€ PnPëª¨ë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  node_modulesë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ì˜€ë‹¤.

`.yarnrc.yml` íŒŒì¼ì„ í”„ë¡œì íŠ¸ì˜ rootì— ìƒì„±í•œ í›„, ì•„ë˜ ë‚´ìš©ì„ ë„£ì–´ì£¼ë©´ ëœë‹¤.

```yml
nodeLinker: node-modules
```

ê·¸ëŸ¬ë©´ PnP ëª¨ë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  `node_modules`ë¥¼ ì‚¬ìš©í•˜ê²Œ ëœë‹¤. í•˜ì§€ë§Œ, ì´ëŸ¬ë©´ yarn berryë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ê°€ ì—†ë‹¤ê³  ìƒê°í•´ì„œ ë‹¤ë¥¸ ë°©ë²•ì„ ì°¾ì•„ í•´ë§¸ë‹¤.

ê²°êµ­ ì›í•˜ë˜ ë‚´ìš©ì€ ê³µì‹ ë¬¸ì„œì—ì„œ ì°¾ì„ ìˆ˜ ìˆì—ˆë‹¤. (ê·€ì°®ë”ë¼ë„ ê³µì‹ ë¬¸ì„œë¥¼ ì œì¼ ë¨¼ì € ì½ì–´ë³´ì...)

### Pnp loose mode
ê³µì‹ ë¬¸ì„œì˜ loose mode ì„¤ëª… ë¶€ë¶„ì˜ ì²« ë¬¸ë‹¨ì¸ë°, ì§€ê¸ˆ ë¬¸ì œì™€ ì •í™•íˆ ì¼ì¹˜í•œë‹¤.

> Because the hoisting heuristics aren't standardized and predictable, 
> PnP operating under strict mode will prevent packages from requiring dependencies that are not explicitly listed; 
> even if other dependencies also depend on it. This may cause issues with some packages.

Loose modeë¥¼ ì‚¬ìš©í•˜ë©´, PnP linkerê°€ node_modulesë¥¼ ì‚¬ìš©í–ˆì„ ë•Œ í˜¸ì´ìŠ¤íŒ… ë  íŒ¨í‚¤ì§€ë“¤ì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•œ í›„ ì´ ë¦¬ìŠ¤íŠ¸ë¥¼ ê¸°ì–µí•œë‹¤.
Yarnì—ì„œëŠ” ì´ ë¦¬ìŠ¤íŠ¸ë¥¼ 'fallback pool'ì´ë¼ ë¶€ë¥¸ë‹¤ê³  í•œë‹¤.

ì´ì œ ëŸ°íƒ€ì„ì— ë§Œì•½ íŒ¨í‚¤ì§€ê°€ ëª…ì‹œí•˜ì§€ ì•Šì€ ì˜ì¡´ì„±ì„ ìš”êµ¬í•œ ê²½ìš°, fallback poolì— ê·¸ ì˜ì¡´ì„±ì´ ìˆìœ¼ë©´ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

PnP strict ëª¨ë“œì™€ node_modules ë§ì»¤ì˜ ì ˆì¶©ì•ˆìœ¼ë¡œ ìƒê°í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.

ì‚¬ìš©ë°©ë²•ì€ ì•„ê¹Œì™€ ê°™ì´ `.yarnrc.yml`íŒŒì¼ì„ ìƒì„±í•œ í›„, ì•„ë˜ ë‚´ìš©ì„ ë„£ì–´ì£¼ë©´ ëœë‹¤.

```yml
pnpMode: loose
```

ì´ ë°©ë²•ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì—ˆë‹¤.

## ë§ˆì¹˜ë©°
ë¬¸ì œê°€ ìƒê¸°ë©´ ì—ëŸ¬ë¥¼ ëƒ…ë‹¤ êµ¬ê¸€ì— ê°ˆê²¨ë²„ë¦¬ëŠ” ìŠµê´€ì´ ìˆëŠ”ë°, ì´ì œëŠ” ë¨¼ì € ê³µì‹ ë¬¸ì„œë¶€í„° ë´ì•¼ê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.
ê³µì‹ ë¬¸ì„œëŠ” ë„ˆë¬´ ì¥ë¬¸ì´ë¼ ì½ê¸° ì‹«ì–´ì§€ëŠ” ê±´ ì°¸ì•„ë³´ì...

ê·¸ë¦¬ê³  Yarnì´ êµ‰ì¥íˆ ì¢‹ë‹¤ê³  ëŠê»´ì§€ê¸´ í•œë°, ì“°ê¸° ê·€ì°®ì€ ê²ƒ ê°™ë‹¤.

<br/>

ì°¸ì¡°:
* [Yarn Berry ì ìš© 1ì¼ ì°¨ì´ ëŠë‚€ ì ](https://velog.io/@johnwi/wil-01-Yarn-Berry#plugnplay-%EB%84%88%EB%AC%B4-%EC%A2%8B%EC%95%84%EB%B3%B4%EC%9D%B4%EB%8A%94%EB%8D%B0-%EC%93%B8-%EC%88%98%EA%B0%80)
* [How to use Yarn 3 with React Native](https://levelup.gitconnected.com/how-to-use-yarn-3-with-react-native-and-how-to-migrate-c5f108108533)
* [Plugâ€™nâ€™Play | Yarn - Package Manager](https://yarnpkg.com/features/pnp#pnp-loose-mode)